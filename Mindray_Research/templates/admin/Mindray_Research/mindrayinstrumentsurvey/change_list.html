{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .stats-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .stat-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 0.25rem;
            padding: 0.75rem;
            text-align: center;
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0066cc;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
        .category-stats, .brand-stats, .ownership-stats {
            margin-top: 1rem;
        }
        .category-stat-item, .brand-stat-item, .ownership-stat-item {
            display: inline-block;
            background: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            margin: 0.25rem;
            font-size: 0.875rem;
        }
        .ownership-our {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .ownership-competitor {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
    </style>
{% endblock %}

{% block content_title %}
    <h1>ä»ªå™¨è°ƒç ”ç®¡ç†</h1>
    
    {% if total_instruments %}
    <div class="stats-container">
        <!-- åŸºç¡€ç»Ÿè®¡ç½‘æ ¼ -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">{{ total_instruments }}</div>
                <div class="stat-label">ä»ªå™¨è®°å½•æ€»æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ total_quantity }}</div>
                <div class="stat-label">è®¾å¤‡æ€»å°æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ total_sample_volume }}</div>
                <div class="stat-label">æ€»æ ‡æœ¬é‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ this_week_count }}</div>
                <div class="stat-label">æœ¬å‘¨æ›´æ–°</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ this_month_count }}</div>
                <div class="stat-label">æœ¬æœˆæ›´æ–°</div>
            </div>
        </div>
        
        <!-- æ ‡æœ¬é‡è¯¦ç»†åˆ†å¸ƒï¼ˆæ ·å¼å’Œåˆ†ç±»ç»Ÿè®¡ä¸€è‡´ï¼‰ -->
        <div class="category-stats">
            <strong>ğŸ“Š æ ‡æœ¬é‡åˆ†å¸ƒï¼š</strong>
            <span class="category-stat-item">è¡€çƒä»ªå™¨: {{ blood_sample_volume }} ä¾‹</span>
            <span class="category-stat-item">ç³–åŒ–ä»ªå™¨: {{ glycation_sample_volume }} ä¾‹</span>
            <span class="category-stat-item">å°¿æ¶²ä»ªå™¨: {{ urine_sample_volume }} ä¾‹</span>
        </div>
        
        <!-- ä»ªå™¨åˆ†ç±»ç»Ÿè®¡ï¼ˆè¡€çƒåœ¨å‰ï¼‰ -->
        {% if category_stats %}
        <div class="category-stats">
            <strong>ğŸ”¬ åˆ†ç±»ç»Ÿè®¡ï¼š</strong>
            {% for category, stats in category_stats.items %}
                <span class="category-stat-item">{{ category }}: {{ stats.count }}ä¸ªè®°å½•/{{ stats.quantity }}å°è®¾å¤‡</span>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- å“ç‰Œç»Ÿè®¡ -->
        {% if brand_stats %}
        <div class="brand-stats">
            <strong>ğŸ·ï¸ å“ç‰Œåˆ†å¸ƒ (Top5)ï¼š</strong>
            {% for brand in brand_stats %}
                <span class="brand-stat-item">{{ brand.brand__brand }}: {{ brand.count }}ä¸ª/{{ brand.total_quantity }}å°</span>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- æˆ‘å¸vsç«å“ç»Ÿè®¡ -->
        <div class="ownership-stats">
            <strong>ğŸ¢ è®¾å¤‡å½’å±ï¼š</strong>
            <span class="ownership-stat-item ownership-our">æˆ‘å¸è®¾å¤‡: {{ our_stats.count }}ä¸ªè®°å½• ({{ our_stats.quantity }}å°, {{ our_percentage }}%)</span>
            <span class="ownership-stat-item ownership-competitor">ç«å“è®¾å¤‡: {{ competitor_stats.count }}ä¸ªè®°å½• ({{ competitor_stats.quantity }}å°)</span>
        </div>
        
        <!-- è£…æœºå¹´ä»½åˆ†å¸ƒ -->
        {% if year_stats %}
        <div class="category-stats">
            <strong>ğŸ“… è£…æœºå¹´ä»½åˆ†å¸ƒï¼š</strong>
            {% for year, count in year_stats.items %}
                <span class="category-stat-item">{{ year }}å¹´: {{ count }}å°</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}
{% endblock %}

{% block content %}
    {{ block.super }}
{% endblock %}